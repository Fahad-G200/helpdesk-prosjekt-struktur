{% extends "base.html" %}
{% block content %}
<div class="card">
  <h1> Brukerhåndtering</h1>
  <p class="muted">Administrer alle brukere i systemet</p>
</div>

<div class="card">
  <table style="width:100%; border-collapse:collapse;">
    <thead>
      <tr style="background:#0f172a; border-bottom:1px solid #334155;">
        <th style="padding:12px; text-align:left;">Brukernavn</th>
        <th style="padding:12px; text-align:left;">Rolle</th>
        <th style="padding:12px; text-align:left;">E-post</th>
        <th style="padding:12px; text-align:left;">Opprettet</th>
        <th style="padding:12px; text-align:left;">Sist innlogget</th>
        <th style="padding:12px; text-align:right;">Handlinger</th>
      </tr>
    </thead>
    <tbody>
      {% for u in users %}
      <tr style="border-bottom:1px solid #1e293b;">
        <td style="padding:12px;">
          <strong>{{ u.username }}</strong>
          {% if u.username == session.get("user") %}<span style="color:#10b981;">(Deg)</span>{% endif %}
        </td>
        <td style="padding:12px;">
          {% if u.role == 'support' %}
            <span style="background:#3b82f6; color:#fff; padding:4px 8px; border-radius:4px; font-size:12px;">️ Support</span>
          {% else %}
            <span style="background:#64748b; color:#fff; padding:4px 8px; border-radius:4px; font-size:12px;"> User</span>
          {% endif %}
        </td>
        <td style="padding:12px; color:#94a3b8;">{{ u.email or '—' }}</td>
        <td style="padding:12px; color:#94a3b8;">{{ u.created_at }}</td>
        <td style="padding:12px; color:#94a3b8;">{{ u.last_login or 'Aldri' }}</td>
        <td style="padding:12px; text-align:right;">
          {% if u.username != 'admin' and u.username != session.get("user") %}
            <div style="display:flex; gap:8px; justify-content:flex-end; flex-wrap:wrap;">
              <form method="post" action="{{ url_for('main.admin_reset_password', username=u.username) }}" style="display:inline;">
                <button type="submit" style="background:#8b5cf6; padding:6px 12px; font-size:12px;"> Nytt passord</button>
              </form>
              
              {% if u.role == 'user' %}
              <form method="post" action="{{ url_for('main.promote_user', username=u.username) }}" style="display:inline;">
                <button type="submit" style="background:#10b981; padding:6px 12px; font-size:12px;">⬆️ Promote</button>
              </form>
              {% else %}
              <form method="post" action="{{ url_for('main.demote_user', username=u.username) }}" style="display:inline;">
                <button type="submit" style="background:#f59e0b; padding:6px 12px; font-size:12px;">⬇️ Demote</button>
              </form>
              {% endif %}
              
              <form method="post" action="{{ url_for('main.delete_user', username=u.username) }}" style="display:inline;" onsubmit="return confirm('Slette bruker {{ u.username }}? Dette kan ikke angres!');">
                <button type="submit" style="background:#ef4444; padding:6px 12px; font-size:12px;">️ Slett</button>
              </form>
            </div>
          {% else %}
            <span style="color:#64748b; font-size:12px;">Ingen handlinger</span>
          {% endif %}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<div class="card" style="background:rgba(59,130,246,.1); border-color:#3b82f6;">
  <h3> Statistikk</h3>
  <p><strong>Totalt brukere:</strong> {{ users|length }}</p>
  <p><strong>Support-brukere:</strong> {{ users|selectattr('role', 'equalto', 'support')|list|length }}</p>
  <p><strong>Vanlige brukere:</strong> {{ users|selectattr('role', 'equalto', 'user')|list|length }}</p>
</div>
{% endblock %}