<!-- ============================================================================
FILE: templates/admin_users.html
============================================================================ -->
{% extends "base.html" %}
{% block content %}
<div class="card">
  <h1>ğŸ‘¥ BrukerhÃ¥ndtering</h1>
  <p class="muted">Administrer alle brukere i systemet</p>
</div>

<div class="card">
  <table style="width:100%; border-collapse:collapse;">
    <thead>
      <tr style="background:#0f172a; border-bottom:1px solid #334155;">
        <th style="padding:12px; text-align:left;">Brukernavn</th>
        <th style="padding:12px; text-align:left;">Rolle</th>
        <th style="padding:12px; text-align:left;">E-post</th>
        <th style="padding:12px; text-align:left;">Opprettet</th>
        <th style="padding:12px; text-align:left;">Sist innlogget</th>
        <th style="padding:12px; text-align:right;">Handlinger</th>
      </tr>
    </thead>
    <tbody>
      {% for u in users %}
      <tr style="border-bottom:1px solid #1e293b;">
        <td style="padding:12px;">
          <strong>{{ u.username }}</strong>
          {% if u.username == session.get("user") %}<span style="color:#10b981;">(Deg)</span>{% endif %}
        </td>
        <td style="padding:12px;">
          {% if u.role == 'support' %}
            <span style="background:#3b82f6; color:#fff; padding:4px 8px; border-radius:4px; font-size:12px;">ğŸ›¡ï¸ Support</span>
          {% else %}
            <span style="background:#64748b; color:#fff; padding:4px 8px; border-radius:4px; font-size:12px;">ğŸ‘¤ User</span>
          {% endif %}
        </td>
        <td style="padding:12px; color:#94a3b8;">{{ u.email or 'â€”' }}</td>
        <td style="padding:12px; color:#94a3b8;">{{ u.created_at }}</td>
        <td style="padding:12px; color:#94a3b8;">{{ u.last_login or 'Aldri' }}</td>
        <td style="padding:12px; text-align:right;">
          {% if u.username != 'admin' and u.username != session.get("user") %}
            <div style="display:flex; gap:8px; justify-content:flex-end;">
              {% if u.role == 'user' %}
              <form method="post" action="{{ url_for('main.promote_user', username=u.username) }}" style="display:inline;">
                <button type="submit" style="background:#10b981; padding:6px 12px; font-size:12px;">â¬†ï¸ Promote</button>
              </form>
              {% else %}
              <form method="post" action="{{ url_for('main.demote_user', username=u.username) }}" style="display:inline;">
                <button type="submit" style="background:#f59e0b; padding:6px 12px; font-size:12px;">â¬‡ï¸ Demote</button>
              </form>
              {% endif %}
              
              <form method="post" action="{{ url_for('main.delete_user', username=u.username) }}" style="display:inline;" onsubmit="return confirm('Slette bruker {{ u.username }}? Dette kan ikke angres!');">
                <button type="submit" style="background:#ef4444; padding:6px 12px; font-size:12px;">ğŸ—‘ï¸ Slett</button>
              </form>
            </div>
          {% else %}
            <span style="color:#64748b; font-size:12px;">Ingen handlinger</span>
          {% endif %}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<div class="card" style="background:rgba(59,130,246,.1); border-color:#3b82f6;">
  <h3>ğŸ“Š Statistikk</h3>
  <p><strong>Totalt brukere:</strong> {{ users|length }}</p>
  <p><strong>Support-brukere:</strong> {{ users|selectattr('role', 'equalto', 'support')|list|length }}</p>
  <p><strong>Vanlige brukere:</strong> {{ users|selectattr('role', 'equalto', 'user')|list|length }}</p>
</div>
{% endblock %}


<!-- ============================================================================
FILE: templates/admin_tickets.html
============================================================================ -->
{% extends "base.html" %}
{% block content %}
<div class="card">
  <h1>ğŸ« SakshÃ¥ndtering</h1>
  <p class="muted">Administrer alle support-saker</p>
</div>

<div class="card">
  <form method="post" action="{{ url_for('main.bulk_close_tickets') }}" id="bulkForm">
    <div style="display:flex; justify-content:space-between; margin-bottom:14px;">
      <div>
        <button type="submit" style="background:#10b981;">âœ“ Lukk valgte</button>
        <button type="submit" formaction="{{ url_for('main.bulk_delete_tickets') }}" style="background:#ef4444;" onclick="return confirm('Slette valgte saker permanent?');">ğŸ—‘ï¸ Slett valgte</button>
      </div>
      <div style="color:#94a3b8;">Totalt: {{ tickets|length }} saker</div>
    </div>

    <table style="width:100%; border-collapse:collapse;">
      <thead>
        <tr style="background:#0f172a; border-bottom:1px solid #334155;">
          <th style="padding:12px; width:40px;"><input type="checkbox" id="selectAll"></th>
          <th style="padding:12px; text-align:left;">ID</th>
          <th style="padding:12px; text-align:left;">Tittel</th>
          <th style="padding:12px; text-align:left;">Eier</th>
          <th style="padding:12px; text-align:left;">Prioritet</th>
          <th style="padding:12px; text-align:left;">Status</th>
          <th style="padding:12px; text-align:left;">Tildelt</th>
          <th style="padding:12px; text-align:right;">Handlinger</th>
        </tr>
      </thead>
      <tbody>
        {% for t in tickets %}
        <tr style="border-bottom:1px solid #1e293b;">
          <td style="padding:12px;">
            <input type="checkbox" name="ticket_ids[]" value="{{ t.id }}" class="ticketCheckbox">
          </td>
          <td style="padding:12px;"><strong>#{{ t.id }}</strong></td>
          <td style="padding:12px;">{{ t.title }}</td>
          <td style="padding:12px; color:#94a3b8;">{{ t.owner }}</td>
          <td style="padding:12px;">
            {% if t.priority in ['Kritisk', 'HÃ¸y'] %}
              <span style="background:#ef4444; color:#fff; padding:4px 8px; border-radius:4px; font-size:12px;">{{ t.priority }}</span>
            {% elif t.priority == 'Middels' %}
              <span style="background:#f59e0b; color:#fff; padding:4px 8px; border-radius:4px; font-size:12px;">{{ t.priority }}</span>
            {% else %}
              <span style="background:#10b981; color:#fff; padding:4px 8px; border-radius:4px; font-size:12px;">{{ t.priority }}</span>
            {% endif %}
          </td>
          <td style="padding:12px;">
            {% if t.status == 'Ã…pen' %}
              <span style="background:#3b82f6; color:#fff; padding:4px 8px; border-radius:4px; font-size:12px;">Ã…pen</span>
            {% elif t.status == 'Lukket' %}
              <span style="background:#64748b; color:#fff; padding:4px 8px; border-radius:4px; font-size:12px;">Lukket</span>
            {% endif %}
          </td>
          <td style="padding:12px; color:#94a3b8;">{{ t.assigned_to or 'â€”' }}</td>
          <td style="padding:12px; text-align:right;">
            <div style="display:flex; gap:6px; justify-content:flex-end; flex-wrap:wrap;">
              {% if t.status != 'Lukket' %}
              <form method="post" action="{{ url_for('main.assign_ticket_to_support', ticket_id=t.id) }}" style="display:inline;">
                <select name="assigned_to" style="padding:4px; font-size:12px; margin:0; width:auto;">
                  <option value="{{ session.get('user') }}">Meg selv</option>
                </select>
                <button type="submit" style="background:#3b82f6; padding:4px 8px; font-size:12px;">ğŸ“Œ</button>
              </form>
              
              <form method="post" action="{{ url_for('main.change_ticket_priority', ticket_id=t.id) }}" style="display:inline;">
                <select name="priority" style="padding:4px; font-size:12px; margin:0; width:auto;">
                  <option>Lav</option>
                  <option>Middels</option>
                  <option>HÃ¸y</option>
                  <option>Kritisk</option>
                </select>
                <button type="submit" style="background:#f59e0b; padding:4px 8px; font-size:12px;">âš ï¸</button>
              </form>
              
              <form method="post" action="{{ url_for('main.close_ticket_view', ticket_id=t.id) }}" style="display:inline;">
                <button type="submit" style="background:#10b981; padding:4px 8px; font-size:12px;">âœ“</button>
              </form>
              {% endif %}
              
              <form method="post" action="{{ url_for('main.delete_ticket_permanently', ticket_id=t.id) }}" style="display:inline;" onsubmit="return confirm('Slette sak #{{ t.id }} permanent?');">
                <button type="submit" style="background:#ef4444; padding:4px 8px; font-size:12px;">ğŸ—‘ï¸</button>
              </form>
            </div>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </form>
</div>

<script>
  document.getElementById('selectAll').addEventListener('change', function() {
    const checkboxes = document.querySelectorAll('.ticketCheckbox');
    checkboxes.forEach(cb => cb.checked = this.checked);
  });
</script>
{% endblock %}


<!-- ============================================================================
FILE: templates/admin_kb.html
============================================================================ -->
{% extends "base.html" %}
{% block content %}
<div class="card">
  <div style="display:flex; justify-content:space-between; align-items:center;">
    <div>
      <h1>ğŸ“š Kunnskapsbase-administrasjon</h1>
      <p class="muted">Administrer alle KB-artikler</p>
    </div>
    <a href="{{ url_for('main.create_article_view') }}" style="background:#10b981; color:#fff; padding:10px 16px; border-radius:8px; text-decoration:none; font-weight:900;">+ Ny artikkel</a>
  </div>
</div>

<div class="card">
  <table style="width:100%; border-collapse:collapse;">
    <thead>
      <tr style="background:#0f172a; border-bottom:1px solid #334155;">
        <th style="padding:12px; text-align:left;">ID</th>
        <th style="padding:12px; text-align:left;">Tittel</th>
        <th style="padding:12px; text-align:left;">Forfatter</th>
        <th style="padding:12px; text-align:left;">Opprettet</th>
        <th style="padding:12px; text-align:right;">Handlinger</th>
      </tr>
    </thead>
    <tbody>
      {% for a in articles %}
      <tr style="border-bottom:1px solid #1e293b;">
        <td style="padding:12px;"><strong>#{{ a.id }}</strong></td>
        <td style="padding:12px;">{{ a.title }}</td>
        <td style="padding:12px; color:#94a3b8;">{{ a.author }}</td>
        <td style="padding:12px; color:#94a3b8;">{{ a.created_at }}</td>
        <td style="padding:12px; text-align:right;">
          <div style="display:flex; gap:8px; justify-content:flex-end;">
            <a href="{{ url_for('main.view_article', article_id=a.id) }}" style="background:#3b82f6; color:#fff; padding:6px 12px; border-radius:6px; text-decoration:none; font-size:12px;">ğŸ‘ï¸ Vis</a>
            <a href="{{ url_for('main.edit_article_view', article_id=a.id) }}" style="background:#f59e0b; color:#fff; padding:6px 12px; border-radius:6px; text-decoration:none; font-size:12px;">âœï¸ Rediger</a>
            <form method="post" action="{{ url_for('main.delete_article', article_id=a.id) }}" style="display:inline;" onsubmit="return confirm('Slette artikkel #{{ a.id }}?');">
              <button type="submit" style="background:#ef4444; padding:6px 12px; font-size:12px;">ğŸ—‘ï¸ Slett</button>
            </form>
          </div>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}


<!-- ============================================================================
FILE: templates/create_article.html
============================================================================ -->
{% extends "base.html" %}
{% block content %}
<div class="card">
  <h2>ğŸ“ Opprett ny KB-artikkel</h2>
  <form method="post">
    <label>Tittel</label>
    <input type="text" name="title" required placeholder="F.eks. Hvordan logge inn pÃ¥ Feide">
    
    <label>Innhold</label>
    <textarea name="content" rows="15" required placeholder="Skriv artikkelen her..."></textarea>
    
    <div style="display:flex; gap:10px; margin-top:10px;">
      <button type="submit" style="background:#10b981;">ğŸ’¾ Lagre</button>
      <a href="{{ url_for('main.admin_kb') }}" style="background:#64748b; color:#fff; padding:10px 16px; border-radius:8px; text-decoration:none; font-weight:900;">Avbryt</a>
    </div>
  </form>
</div>
{% endblock %}


<!-- ============================================================================
FILE: templates/view_article.html
============================================================================ -->
{% extends "base.html" %}
{% block content %}
<div class="card">
  <h2>{{ article.title }}</h2>
  <p class="muted">Forfatter: {{ article.author }} | {{ article.created_at }}</p>
  <div style="white-space: pre-wrap; margin-top:20px;">{{ article.content }}</div>
  
  {% if role == "support" %}
  <div style="margin-top:20px; padding-top:20px; border-top:1px solid #334155;">
    <a href="{{ url_for('main.edit_article_view', article_id=article.id) }}" style="background:#f59e0b; color:#fff; padding:8px 16px; border-radius:8px; text-decoration:none; margin-right:10px;">âœï¸ Rediger</a>
    <form method="post" action="{{ url_for('main.delete_article', article_id=article.id) }}" style="display:inline;" onsubmit="return confirm('Slette denne artikkelen?');">
      <button type="submit" style="background:#ef4444;">ğŸ—‘ï¸ Slett</button>
    </form>
  </div>
  {% endif %}
</div>
{% endblock %}


<!-- ============================================================================
FILE: templates/edit_article.html
============================================================================ -->
{% extends "base.html" %}
{% block content %}
<div class="card">
  <h2>âœï¸ Rediger artikkel</h2>
  <form method="post">
    <label>Tittel</label>
    <input type="text" name="title" value="{{ article.title }}" required>
    
    <label>Innhold</label>
    <textarea name="content" rows="15" required>{{ article.content }}</textarea>
    
    <div style="display:flex; gap:10px; margin-top:10px;">
      <button type="submit" style="background:#10b981;">ğŸ’¾ Lagre endringer</button>
      <a href="{{ url_for('main.view_article', article_id=article.id) }}" style="background:#64748b; color:#fff; padding:10px 16px; border-radius:8px; text-decoration:none; font-weight:900;">Avbryt</a>
    </div>
  </form>
</div>
{% endblock %}


<!-- ============================================================================
FILE: templates/admin_settings.html
============================================================================ -->
{% extends "base.html" %}
{% block content %}
<div class="card">
  <h1>âš™ï¸ Systeminnstillinger</h1>
  <p class="muted">Administrer systeminnstillinger (kommer snart)</p>
</div>

<div class="card">
  <h3>ğŸ”§ Generelle innstillinger</h3>
  <form method="post">
    <label>Systemets navn</label>
    <input type="text" name="system_name" value="IT Helpdesk" placeholder="IT Helpdesk">
    
    <label>Support e-post</label>
    <input type="email" name="support_email" value="support@helpdesk.no" placeholder="support@helpdesk.no">
    
    <label>Maksimal filstÃ¸rrelse (MB)</label>
    <input type="number" name="max_file_size" value="16" placeholder="16">
    
    <button type="submit" style="background:#10b981; margin-top:10px;">ğŸ’¾ Lagre innstillinger</button>
  </form>
</div>

<div class="card" style="background:rgba(239,68,68,.1); border-color:#ef4444;">
  <h3>âš ï¸ Farlige handlinger</h3>
  <p style="color:#fca5a5;">VÃ¦r forsiktig med disse handlingene!</p>
  
  <button style="background:#ef4444; margin-top:10px;" onclick="alert('Denne funksjonen kommer snart!');">ğŸ—‘ï¸ Slett alle lukkede saker</button>
  <button style="background:#ef4444; margin-top:10px; margin-left:10px;" onclick="alert('Denne funksjonen kommer snart!');">ğŸ”„ Nullstill database</button>
</div>
{% endblock %}