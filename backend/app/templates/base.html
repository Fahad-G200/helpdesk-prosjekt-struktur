<!doctype html>
<html lang="no">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Helpdesk</title>

    <style>
      :root{
        --bg:#f4f6f8; --text:#222; --muted:#666;
        --card:#fff; --border:#e5e7eb;
        --primary:#2563eb; --primaryHover:#1d4ed8;
        --green:#16a34a; --yellow:#ca8a04; --red:#dc2626;
      }
      body{
        font-family: Arial, sans-serif;
        max-width: 980px;
        margin: 40px auto;
        padding: 0 16px;
        background: var(--bg);
        color: var(--text);
      }
      header{
        display:flex; justify-content:space-between; align-items:center;
        margin-bottom: 18px;
      }
      nav{ display:flex; gap:12px; align-items:center; flex-wrap:wrap; }
      nav a{
        color: var(--primary);
        text-decoration:none;
        font-weight:700;
      }
      nav a:hover{ text-decoration:underline; }

      .pill{
        background:#eef2ff;
        border:1px solid #dbeafe;
        color:#1e3a8a;
        padding:6px 10px;
        border-radius:999px;
        font-size:.9rem;
        white-space:nowrap;
      }
      .card{
        background:var(--card);
        border:1px solid var(--border);
        border-radius:12px;
        padding:16px;
        margin:14px 0;
        box-shadow:0 2px 6px rgba(0,0,0,.05);
      }
      .muted{ color: var(--muted); }
      h1,h2,h3{ margin-top:0; }

      input, textarea, select{
        width:100%;
        padding:12px;
        margin:8px 0 14px;
        border-radius:10px;
        border:1px solid #cfd6df;
        box-sizing:border-box;
        font-size:1rem;
      }

      .btn, button{
        display:inline-block;
        background: var(--primary);
        color:#fff;
        border:0;
        border-radius:10px;
        padding:10px 14px;
        font-weight:800;
        cursor:pointer;
        text-decoration:none;
      }
      .btn:hover, button:hover{ background: var(--primaryHover); }

      .btn-secondary{
        background:#475569;
      }
      .btn-secondary:hover{
        background:#334155;
      }

      .flash{
        border-left:6px solid var(--green);
      }

      .badge{
        display:inline-block;
        padding:4px 10px;
        border-radius:999px;
        font-size:.85rem;
        font-weight:800;
      }
      .badge-open{ background:#dcfce7; color:#14532d; border:1px solid #bbf7d0; }
      .badge-closed{ background:#fee2e2; color:#7f1d1d; border:1px solid #fecaca; }

      .level1{ border-left:6px solid var(--green); }
      .level2{ border-left:6px solid var(--yellow); }
      .level3{ border-left:6px solid var(--red); }

      .row{ display:flex; gap:12px; flex-wrap:wrap; }
      .row > *{ flex: 1 1 260px; }
    </style>
  </head>

  <body>
    <header>
      <strong>Helpdesk</strong>

      <nav>
        {% if session.get("user") %}
          <span class="pill">Innlogget: {{ session.get("user") }} ({{ session.get("role") }})</span>
          <a href="{{ url_for('main.kb') }}">Kunnskapsbase</a>
          <a href="{{ url_for('main.tickets') }}">Mine saker</a>
          <a href="{{ url_for('main.logout') }}">Logg ut</a>
        {% endif %}
      </nav>
    </header>

    {# Flash-meldinger (f.eks. “Sak opprettet”) #}
    {% with messages = get_flashed_messages() %}
      {% if messages %}
        {% for m in messages %}
          <div class="card flash">{{ m }}</div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    {% block content %}{% endblock %}

    <!-- Enkel chatbot-widget -->
<div id="chatbot" style="position:fixed; right:18px; bottom:18px; width:320px; max-width:92vw; z-index:9999;">
  <div class="card" style="margin:0;">
    <div style="display:flex; justify-content:space-between; align-items:center; gap:10px;">
      <strong>Helpdesk-chat</strong>
      <button id="chatToggle" class="btn-secondary" type="button" style="padding:6px 10px; border-radius:10px;">Skjul</button>
    </div>

    <div id="chatBody" style="margin-top:10px;">
      <div id="chatLog" style="height:180px; overflow:auto; border:1px solid #e5e7eb; border-radius:10px; padding:10px; background:#fff;">
        <div class="muted" style="margin-bottom:8px;">
          Hei! Skriv hva du trenger hjelp med (Feide, Wi-Fi, utskrift, passord).
        </div>
      </div>

      <div style="display:flex; gap:8px; margin-top:10px;">
        <input id="chatInput" type="text" placeholder="Skriv her..." style="margin:0;" />
        <button id="chatSend" type="button">Send</button>
      </div>

      <p class="muted" style="margin-top:8px; font-size:.9rem;">
        Chat er regelbasert (ikke ekte AI). Den gir forslag basert på nøkkelord.
      </p>
    </div>
  </div>
</div>

<script>
  (function() {
    const log = document.getElementById("chatLog");
    const input = document.getElementById("chatInput");
    const sendBtn = document.getElementById("chatSend");
    const toggleBtn = document.getElementById("chatToggle");
    const body = document.getElementById("chatBody");

    function addMsg(who, text) {
      const wrap = document.createElement("div");
      wrap.style.margin = "8px 0";
      wrap.innerHTML = `<strong>${who}:</strong> <span style="white-space:pre-wrap;"></span>`;
      wrap.querySelector("span").textContent = text;
      log.appendChild(wrap);
      log.scrollTop = log.scrollHeight;
    }

    async function send() {
      const msg = (input.value || "").trim();
      if (!msg) return;
      addMsg("Du", msg);
      input.value = "";
      input.focus();

      try {
        const res = await fetch("/chat", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ message: msg })
        });

        const data = await res.json().catch(() => ({}));
        if (!res.ok) {
          addMsg("Bot", data.reply || "Noe gikk galt. Prøv igjen.");
          return;
        }
        addMsg("Bot", data.reply || "Ingen svar.");
      } catch (e) {
        addMsg("Bot", "Kunne ikke kontakte serveren. Er du pålogget og kjører appen?");
      }
    }

    sendBtn.addEventListener("click", send);
    input.addEventListener("keydown", (e) => {
      if (e.key === "Enter") send();
    });

    toggleBtn.addEventListener("click", () => {
      const hidden = body.style.display === "none";
      body.style.display = hidden ? "" : "none";
      toggleBtn.textContent = hidden ? "Skjul" : "Vis";
    });
  })();
</script>

  
  </body>
</html>