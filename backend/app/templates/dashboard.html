{% extends "base.html" %}

{% block title %}Dashboard ‚Äì Helpdesk{% endblock %}
{% block header_title %}Ticket Dashboard{% endblock %}
{% block header_subtitle %}Oversikt over aktive saker{% endblock %}
{% block page_title %}Dashboard{% endblock %}

{% block content %}

<style>
  /* Dashboard-only styling (p√•virker kun innholdet i dashboard-siden) */
  .dash-wrap{
    background:#0b1220;
    border:1px solid #0f1a2e;
    border-radius:16px;
    padding:22px;
    color:#e5e7eb;
  }
  .dash-top{
    display:flex;
    justify-content:space-between;
    align-items:center;
    gap:14px;
    flex-wrap:wrap;
    margin-bottom:18px;
  }
  .dash-title h1{
    margin:0;
    font-size:28px;
    font-weight:900;
  }
  .dash-title p{
    margin:6px 0 0;
    color:#94a3b8;
  }
  .dash-cta{
    display:inline-flex;
    align-items:center;
    gap:8px;
    padding:12px 16px;
    border-radius:12px;
    background:#0284c7;
    color:#fff;
    font-weight:900;
    text-decoration:none;
    box-shadow:0 10px 28px rgba(2,132,199,.25);
  }
  .dash-cta:hover{ filter:brightness(1.06); }

  .dash-grid{
    display:grid;
    grid-template-columns:repeat(4, minmax(0, 1fr));
    gap:14px;
    margin-bottom:18px;
  }
  @media (max-width: 980px){
    .dash-grid{ grid-template-columns:repeat(2, minmax(0, 1fr)); }
  }
  @media (max-width: 560px){
    .dash-grid{ grid-template-columns:1fr; }
  }

  .stat{
    background:rgba(15,23,42,.65);
    border:1px solid rgba(148,163,184,.12);
    border-radius:14px;
    padding:16px;
    display:flex;
    justify-content:space-between;
    gap:12px;
  }
  .stat .label{ color:#94a3b8; font-size:13px; }
  .stat .value{ font-size:30px; font-weight:900; color:#38bdf8; margin-top:8px; }
  .stat .icon{ font-size:22px; opacity:.95; }

  .table-card{
    background:rgba(15,23,42,.65);
    border:1px solid rgba(148,163,184,.12);
    border-radius:14px;
    overflow:hidden;
  }
  .table-head{
    display:flex;
    justify-content:space-between;
    align-items:center;
    gap:10px;
    padding:14px 16px;
    border-bottom:1px solid rgba(148,163,184,.10);
  }
  .table-head h2{
    margin:0;
    font-size:16px;
    font-weight:900;
  }
  .table-actions{
    display:flex;
    gap:8px;
    flex-wrap:wrap;
  }
  .chip{
    background:rgba(148,163,184,.10);
    border:1px solid rgba(148,163,184,.12);
    color:#e5e7eb;
    padding:7px 10px;
    border-radius:999px;
    font-size:12px;
    font-weight:800;
  }

  table{
    width:100%;
    border-collapse:collapse;
  }
  thead th{
    text-align:left;
    font-size:12px;
    letter-spacing:.02em;
    color:#94a3b8;
    padding:12px 16px;
    background:rgba(148,163,184,.06);
  }
  tbody td{
    padding:12px 16px;
    border-top:1px solid rgba(148,163,184,.10);
    font-size:14px;
    color:#e5e7eb;
    vertical-align:top;
  }
  tbody tr:hover{
    background:rgba(56,189,248,.06);
  }
  .mono{ font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
  .id{ color:#38bdf8; font-weight:900; }

  .pill-pri{
    display:inline-flex;
    align-items:center;
    gap:6px;
    padding:6px 10px;
    border-radius:999px;
    font-size:12px;
    font-weight:900;
    border:1px solid rgba(148,163,184,.18);
    background:rgba(148,163,184,.08);
  }
  .pri-critical{
    background:rgba(239,68,68,.12);
    border-color:rgba(239,68,68,.25);
    color:#fca5a5;
  }
  .pri-medium{
    background:rgba(234,179,8,.12);
    border-color:rgba(234,179,8,.25);
    color:#fde68a;
  }
  .pri-low{
    background:rgba(16,185,129,.12);
    border-color:rgba(16,185,129,.25);
    color:#86efac;
  }
  .muted{ color:#94a3b8; }
</style>

<div class="dash-wrap">
  <div class="dash-top">
    <div class="dash-title">
      <h1>Ticket Dashboard</h1>
      <p>Oversikt over aktive saker</p>
    </div>

    <a class="dash-cta" href="{{ url_for('main.tickets') }}">
      <span style="font-size:18px;">+</span> Ny sak
    </a>
  </div>

  <div class="dash-grid">
    <div class="stat">
      <div>
        <div class="label">Totalt aktive</div>
        <div class="value">{{ stats.total_active }}</div>
      </div>
      <div class="icon">üìã</div>
    </div>

    <div class="stat">
      <div>
        <div class="label">Kritiske</div>
        <div class="value">{{ stats.critical }}</div>
      </div>
      <div class="icon">üî¥</div>
    </div>

    <div class="stat">
      <div>
        <div class="label">L√∏st i dag</div>
        <div class="value">{{ stats.closed_today }}</div>
      </div>
      <div class="icon">‚úÖ</div>
    </div>

    <div class="stat">
      <div>
        <div class="label">Gjennomsnittlig tid</div>
        <div class="value">{{ stats.avg_time }}</div>
      </div>
      <div class="icon">‚è±Ô∏è</div>
    </div>
  </div>

  <div class="table-card">
    <div class="table-head">
      <h2>Aktive saker</h2>
      <div class="table-actions">
        <span class="chip">Filtrer</span>
        <span class="chip">Sorter</span>
      </div>
    </div>

    <div style="overflow:auto;">
      <table>
        <thead>
          <tr>
            <th style="min-width:90px;">ID</th>
            <th style="min-width:240px;">Sak</th>
            <th style="min-width:130px;">Prioritet</th>
            <th style="min-width:140px;">Status</th>
            <th style="min-width:160px;">Eier</th>
            <th style="min-width:170px;">Opprettet</th>
          </tr>
        </thead>
        <tbody>
          {% for t in tickets %}
          <tr>
            <td class="mono id">{{ t.id }}</td>
            <td><strong>{{ t.title }}</strong></td>
            <td>
              {% set p = (t.priority or '')|lower %}
              {% if p in ['kritisk','critical','h√∏y','high'] %}
                <span class="pill-pri pri-critical">Kritisk</span>
              {% elif p in ['middels','medium'] %}
                <span class="pill-pri pri-medium">Middels</span>
              {% else %}
                <span class="pill-pri pri-low">Lav</span>
              {% endif %}
            </td>
            <td class="muted">{{ t.status }}</td>
            <td class="muted">{{ t.owner }}</td>
            <td class="muted">{{ t.created_at }}</td>
          </tr>
          {% endfor %}
          {% if tickets|length == 0 %}
          <tr>
            <td colspan="6" class="muted">Ingen saker √• vise.</td>
          </tr>
          {% endif %}
        </tbody>
      </table>
    </div>
  </div>
</div>

{% endblock %}  